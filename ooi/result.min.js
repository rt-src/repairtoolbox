var $_GET=getParams();function getResultFileInfo(e){return get(`${API}/Files/result/${e}`).then((e=>{fileInfo=JSON.parse(e),fileInfo&&(fileInfo.resultSize&&(document.getElementById("ressize").innerText=(fileInfo.resultSize/1048576).toFixed(2)),fileInfo.source&&fileInfo.source.sourceSize&&(document.getElementById("srcsize").innerText=(fileInfo.source.sourceSize/1048576).toFixed(2)))}),(e=>{document.getElementById("step_3").setAttribute("hidden",!0),document.getElementById("step_2").removeAttribute("hidden"),document.getElementById("error_description").innerText=e.responseText}))}function getReport(e){return get(`${API}/Files/report/${e}`).then((e=>{resp=JSON.parse(e),resp&&resp.report&&(document.getElementById("report").innerText=resp.report)}),(e=>{}))}function getPreview(e){return get(`${API}/Files/preview/${e}`).then((t=>{if(resp=JSON.parse(t),"undefined"!=typeof debug&&debug,resp&&resp.count>0)if(".json"==resp.extension&&""!=resp.jsonContent)if(".mdb"!=resp.srcFileExtension&&".accdb"!=resp.srcFileExtension||""==resp.jsonContent){if((".ost"==resp.srcFileExtension||".pst"==resp.srcFileExtension)&&""!=resp.jsonContent){previewJson=JSON.parse(resp.jsonContent),debug,(u=document.getElementById("btn-json-preview"))&&(u.setAttribute("data-src","#dialog-content-tree"),u.removeAttribute("hidden"));var n=[];n=previewJson instanceof Array&&previewJson.length>0?previewJson:[previewJson];var r="";n.forEach((e=>{r+=convertPreviewTreeNodeToHtml(e,!0)}));var o=document.getElementById("root-tree");o&&(o.innerHTML=r),u&&u.addEventListener("click",(()=>{"undefined"!=typeof gtag&&gtag("event","click_preview_button"),document.getElementsByClassName("fancybox")[0].click()}),!1)}}else{if(previewJson=JSON.parse(resp.jsonContent),debug,(u=document.getElementById("btn-json-preview"))&&u.removeAttribute("hidden"),void 0!==previewJson.Tables){var s=document.getElementById("v-pills-tab");for(var i in leftPanelInnerHTML="",previewJson.Tables)if(Object.hasOwnProperty.call(previewJson.Tables,i)){previewJson.Tables[i];var d=Object.keys(previewJson.Tables).indexOf(i);leftPanelInnerHTML+=`<a class="nav-link ${0==d?"active":""}" id="v-pills-table-${d}-tab" data-bs-toggle="pill" href="#table-${d}" role="tab" aria-controls="v-pills-table-${d}" aria-selected="true">${i}</a>`}s.innerHTML=leftPanelInnerHTML;var l=document.getElementById("v-pills-tabContent"),a=[],p=0;for(var i in previewJson.Tables)if(Object.hasOwnProperty.call(previewJson.Tables,i)){const e=previewJson.Tables[i];const t=`<div class="tab-pane fade ${0==(d=Object.keys(previewJson.Tables).indexOf(i))?"show active":""}" id="table-${d}" role="tabpanel" aria-labelledby="v-pills-table-${d}-tab"><div class="table-responsive py-2"><table class="table-preview">`;var c="<thead><tr>";const n="</table></div></div>";e instanceof Array&&e.forEach(((e,t)=>{var n="";if(e instanceof Array)0==t?(n='<th scope="col">&nbsp;</th>',e.forEach((e=>{n+=`<th scope="col">${e}</th>`})),n+='<th scope="col">&nbsp;</th></tr></thead><tbody>',p=e.length):(n='<th scope="row">&nbsp;</th>',e.forEach((e=>{n+=`<td>${e}</td>`})),n+='<th scope="row">&nbsp;</th></tr>'),c+=n;else if("string"==typeof e){var r=e.trim().split(" ");r.length>0&&Number.parseInt(r[0])&&(n=`<tr><th scope="row">&nbsp;</th><td class="text-center" colspan="${p}"><strong><span class="color-light-green-dark fs-1">${r[0]}</span> rows more...</strong></td><th scope="row">&nbsp;</th></tr>`),c+=n}})),a.push(t+c+n)}l.innerHTML=a.join("")}u.addEventListener("click",(()=>{"undefined"!=typeof gtag&&gtag("event","click_preview_button")}),!1)}else{var u;(u=document.getElementById("btn-preview")).removeAttribute("hidden"),u.href=`${API}/Files/preview/${e}/1.jpg`;const t=document.getElementById("fancybox-popup-form");for(let n=1;n<=resp.count;n++){var m=document.createElement("a");m.classList.add("fancybox"),m.setAttribute("rel","group"),m.setAttribute("data-fancybox","images"),m.href=`${API}/Files/preview/${e}/${n}.jpg`;var g=document.createElement("img");g.src=`${API}/Files/preview/thmb/${e}/${n}.jpg`,m.appendChild(g),t.appendChild(m)}Fancybox.bind("[data-fancybox]",{transitionIn:"elastic",transitionOut:"elastic",speedIn:600,speedOut:200,overlayShow:!1}),document.getElementById("btn-preview").addEventListener("click",(e=>{"undefined"!=typeof gtag&&gtag("event","click_preview_button"),e.preventDefault(),document.getElementsByClassName("fancybox")[0].click()}),!1)}else document.getElementById("btn-preview").parentNode.classList.add("d-none")}),(e=>{}))}function getDemo(e){return get(`${API}/Files/demo/${e}`).then((t=>{resp=JSON.parse(t),"undefined"!=typeof debug&&debug,resp&&resp.count>0?(document.getElementById("btn-demo").removeAttribute("hidden"),document.getElementById("btn-demo").href=`${API}/Files/demo/${e}/1`):document.getElementById("btn-demo").parentNode.classList.add("d-none")}),(e=>{}))}function getDownloadIndo(e){return get(`${API}/Files/download/${e}/info`).then((t=>{resp=JSON.parse(t),"undefined"!=typeof debug&&debug,resp&&resp.count>0&&(document.getElementById("download-url").href=`${API}/Files/download/${e}?token=${resp.token}`)}),(e=>{window.location="/404.html"}))}function getPayment(e){return get(`${API}/Files/payment/${e}`).then((e=>{resp=JSON.parse(e),"undefined"!=typeof debug&&debug,resp&&resp.amount>0&&(resp.paid?(document.getElementById("download-div").removeAttribute("hidden"),"undefined"!=typeof debug&&debug,getDownloadIndo($_GET.customid)):(document.getElementById("pay-div").removeAttribute("hidden"),document.getElementById("cost").innerText=resp.amount,document.getElementById("pay-url").href=resp.payUrl))}),(e=>{}))}convertPreviewTreeNodeToHtml=(e,t=!1)=>{var n=[`<li class="expanded ${t?"my-3":""}">`];return n.push(`<span>${e.folderName}</span>`),n.push("<ol>"),"0"!=e.folderItems&&n.push(`<li class="normal text-truncate" style="max-width: 171px;">${e.folderItems} items elements</li>`),e.children instanceof Array&&e.children.length>0&&e.children.forEach((e=>{var t=convertPreviewTreeNodeToHtml(e);n.push(t)})),n.push("</ol>"),n.push("</li>"),n.join("")},getResultFileInfo($_GET.customid),getReport($_GET.customid),getPreview($_GET.customid),getDemo($_GET.customid),getPayment($_GET.customid);