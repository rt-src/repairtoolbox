const allowedExt=["ai","pdf","rtf","doc","docx","dot","dotx","xsl","xls","xlt","xlsx","xlsm","xltm","xltx","xlam","dbf","ppt","pptx","mpp","dbx","psd","ost","pst","dwg","cdr","mdb","accdb"];Dropzone.autoDiscover=!1;var isEmailValid=!1,isFileValid=!1;validateEmail=()=>{var e=!0,t="",n=document.getElementById("Email").value;n&&0!=n.length||(e=!1,t="Empty email");return/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(String(n).toLowerCase())||(e=!1,t="Incorrect email"),isEmailValid=e,{ok:e,failMessage:t}},validateFile=e=>{var t=!0,n="";e&&0!=e.size||(t=!1,n="Empty file");var d=e.name.split(".").last();return-1==allowedExt.indexOf(d.toLowerCase())&&(t=!1,n="Not Allowed type"),isFileValid=t,{ok:t,failMessage:n}};var myDropzone=new Dropzone("#uploader",{url:`${API}/Files/upload`,paramName:"file",chunking:!0,timeout:18e4,chunkSize:26214400,parallelChunkUploads:!0,retryChunks:!0,maxFiles:1,clickable:".fileinput-button",autoProcessQueue:!1,init:function(){dzClosure=this;var e=document.getElementById("submit_file");e&&e.addEventListener("click",(function(t){"undefined"!=typeof debug&&debug;validateEmail();t.preventDefault(),t.stopPropagation(),isEmailValid&&isFileValid?dzClosure.processQueue():(e.disabled=!0,"undefined"!=typeof debug&&debug)})),document.getElementById("Email").addEventListener("change",(function(e){"undefined"!=typeof debug&&debug;validateEmail();document.getElementById("submit_file").disabled=!isEmailValid||!isFileValid}))},addedfile:(...e)=>{"undefined"!=typeof debug&&debug},accept:(e,t)=>{"undefined"!=typeof debug&&debug;var n=validateFile(e);n.ok?document.getElementById("check").removeAttribute("hidden"):document.getElementById("check").setAttribute("hidden",!0),isEmailValid&&isFileValid?(document.getElementById("submit_file").disabled=!1,t()):(document.getElementById("submit_file").disabled=!0,t(n.failMessage))},params:(e,t,n)=>n?{_chunkNumber:n.index,_uuid:n.file.upload.uuid}:{_chunkNumber:0,_uuid:e[0].upload.uuid},sending:(e,t,n)=>{"undefined"!=typeof debug&&debug,document.getElementById("offline").setAttribute("hidden",!0),document.getElementById("step_1").setAttribute("hidden",!0),document.getElementById("step_2").removeAttribute("hidden"),document.getElementById("progress-text").innerText="Uploading file",document.getElementById("s1").classList.add("d-none","d-lg-block"),document.getElementById("s2").classList.remove("d-none","d-lg-block"),document.getElementById("sl2").classList.add("active"),document.getElementById("c2").classList.add("active")},uploadprogress:(e,t,n)=>{"undefined"!=typeof debug&&debug,100!=t&&setRepairProgress(t)},success:e=>{"undefined"!=typeof debug&&debug,sendComplete(e)},complete:(...e)=>{"undefined"!=typeof debug&&debug,myDropzone.removeAllFiles(!0)},dictDefaultMessage:""});setRepairProgress=e=>{const t=Math.floor(e);document.getElementById("progress-bar").style.width=t+"%",document.getElementsByClassName("result-progress")[0].innerText=t+"%"},sendComplete=e=>{"undefined"!=typeof debug&&debug;var t=document.getElementById("Email").value;let n="en";"undefined"!=typeof lang&&(n=lang);var d=new FormData;d.append("_uuid",e.upload.uuid),d.append("_filename",e.name),d.append("_totalChunkCount",e.upload.totalChunkCount),d.append("_email",t),d.append("_lang",n),d.append("_connectionId",connection.connectionId);var i=new XMLHttpRequest;i.open("POST",`${API}/Files/finished`),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&i.response&&(resp=JSON.parse(i.response),"undefined"!=typeof debug&&debug,document.getElementById("progress-text").innerText="Repairing file")},i.send(d)},document.getElementsByClassName("dz-button")[0].hidden=!0;const connection=(new signalR.HubConnectionBuilder).withUrl(`${API}/repair_hub`).configureLogging(signalR.LogLevel.Information).withAutomaticReconnect().build();async function start(){try{await connection.start({withCredentials:!1})}catch(e){setTimeout(start,5e3)}}connection.on("FileProcessInfo",(e=>{fileRepairInfo=JSON.parse(e),"undefined"!=typeof debug&&debug;let t="result.html";"undefined"!=typeof resultUrl&&(t=resultUrl),"undefined"!=typeof baseUrl?nextBasePage=baseUrl:nextBasePage=BaseUrl,setRepairProgress(fileRepairInfo.percent),document.getElementById("progress-text").innerText=fileRepairInfo.state,fileRepairInfo.complete&&(fileRepairInfo.success?("undefined"!=typeof debug&&debug,connection.onclose=null,connection.stop(),window.location=nextBasePage+"/"+t+"?customid="+fileRepairInfo.customId):(document.getElementById("step_2_percent").setAttribute("hidden",!0),document.getElementById("step_2_progress").setAttribute("hidden",!0),document.getElementById("step_2_text").setAttribute("hidden",!0),document.getElementById("step_2_fail_data").removeAttribute("hidden"),document.getElementById("step_2_fail_again").removeAttribute("hidden"),document.getElementById("offline").setAttribute("hidden",!0)))})),connection.onclose(start),start();